---
title: "Final Project"
format: html
editor: visual
---

INF 385T.9 - Data Wrangling Final Project: Does Positive Pop Music Portend Positive Attitudes?

Investigation: Do countries with more upbeat number-one songs on pop music charts havehigher overall levels of happiness?

We will be working with data harvested from Spotify about popular music, Billboard ChartData from countries across the world, and the World Happiness Report to determine whethercountries that report higher happiness levels also listen to more upbeat music. Datasetsavailable online list metadata for thousands of popular songs, including songs that have toppedthe charts in countries as far flung as Turkey, Brazil, and Japan.

By filtering large metadatasets of music to find matches with songs that hit number onearound the world, we hope to find trends among popular songs in each nation. We plan to lookat factors such as tempo, danceability, and energy to determine a song’ “upbeat-ness,” usingBillboard charts to determine the average “upbeatness” of popular songs in a given country, andthen visualizing the relative upbeatness of popular music in a country with Life EvaluationScores from the World Happiness Report to determine if there is a correlation between theupbeatness of popular music in a given nation and that nation’s happiness.

While we hoped to use Spotify’s API to harvest up-to-date metadata about currentlypopular songs in various locales, Spotify unfortunately removed this feature from their API lastfall. However, ample archived datasets of thousands of songs exist on Kaggle and Github.Between these datasets, Billboard Chart data,, and the World Happiness Report, we hope touncover answers to the following questions:

Do happier countries listen to more upbeat, danceable music?

If so, will these trends appear regardless of socioeconomic factors like GDP per capita, or will weneed to control for wealth and human development?

Have these trends changed since 2023, when the analytic data was collected?Or do the happier countries’ trend remain the same?

R Tidyverse

Load tidyverse and other analytic packages

{r}

library(tidyverse)

Import Dataset 1

Import Dataset 2

Import & Wrangle Dataset 3 - World Data 2023 (Kaggle)

{r}

## Import world_data_2023
world_data_2023

{r}

## Select County and Abbreviation columns only
## and assign it to a new table
abbreviation_table <- world_data_2023 |>
                        select(Country, Abbreviation)

abbreviation_table

Import & Wrangle Dataset 4 - Weekly Charts of October 16, 2025 (Kworb)

https://stringr.tidyverse.org/reference/case.html

https://stringr.tidyverse.org/reference/word.html

Ireland Dataset

{r}

## Import weekly chart of Ireland and remove all columns 
## except for the Artist.and.Title column.
## Separate artist and song title from the Artist.and.Title column.
## Only keep the first artist
## Remove any white space before and after string
## Change both columns to all lowercase for easier matching
ireland_2025 <- `10_16_25_ireland` |>
                  select(Artist.and.Title) |>
                  separate_wider_delim(Artist.and.Title, 
                                       delim = "-",
                                       names = c("Artist", "Title"),
                                       too_many = "merge") |>
                  mutate(Artist = word(Artist, 1, sep = ",")) |>
                  mutate(Artist = str_to_lower(str_trim(Artist)),
                         Title = str_to_lower(str_trim(Title)))

ireland_2025

New Zealand Dataset

{r}

## Import weekly chart of New Zealand and remove all columns 
## except for the Artist.and.Title column.
## Separate artist and song title from the Artist.and.Title column
## Only keep the first artist
## Remove any white space before and after string
## Change both columns to all lowercase for easier matching
new_zealand_2025 <- `10_16_25_new_zealand` |>
                      select(Artist.and.Title) |>
                      separate_wider_delim(Artist.and.Title, 
                                           delim = "-",
                                           names = c("Artist", "Title"),
                                           too_many = "merge") |>
                      mutate(Artist = word(Artist, 1, sep = ",")) |>
                      mutate(Artist = str_to_lower(str_trim(Artist)),
                             Title = str_to_lower(str_trim(Title))) 

new_zealand_2025

South Korea Dataset

{r}

## Import weekly chart of South Korea and remove all columns 
## except for the Artist.and.Title column
## Separate artist and song title from the Artist.and.Title column
## Only keep the first artist
## Remove any white space before and after string
## Change both columns to all lowercase for easier matching
south_korea_2025 <- `10_16_25_korea` |>
                      select(Artist.and.Title) |>
                      separate_wider_delim(Artist.and.Title, 
                                           delim = "-",
                                           names = c("Artist", "Title"),
                                           too_many = "merge") |>
                      mutate(Artist = word(Artist, 1, sep = ",")) |>
                      mutate(Artist = str_to_lower(str_trim(Artist)),
                             Title = str_to_lower(str_trim(Title)))  

south_korea_2025

USA Dataset

{r}

## Import weekly chart of USA and remove all columns 
## except for the Artist.and.Title column
## Separate artist and song title from the Artist.and.Title column
## Only keep the first artist
## Remove any white space before and after string
## Change both columns to all lowercase for easier matching
usa_2025 <- `10_16_25_usa` |>
               select(Artist.and.Title) |>
               separate_wider_delim(Artist.and.Title, 
                                    delim = "-",
                                    names = c("Artist", "Title"),
                                    too_many = "merge") |>
                mutate(Artist = word(Artist, 1, sep = ",")) |>
                mutate(Artist = str_to_lower(str_trim(Artist)),
                       Title = str_to_lower(str_trim(Title))) 

usa_2025

Import & Wrangle Dataset 5 - Universal Top Spotify Songs (Kaggle)

https://readr.tidyverse.org/reference/type_convert.html

https://dplyr.tidyverse.org/reference/relocate.html

{r}

## Import the Universal Top Spotify Songs dataset
## Keep following columns only:
## name, artists, danceability, energy, loudness, liveness, tempo
## Only keep the first artist
## Change both columns to all lowercase for easier matching
spotify_2025_R <- universal_top_spotify_songs |>
                    select(name, artists, danceability, energy, loudness, liveness, tempo) |>
                    rename(title = name) |>
                    mutate(artists = str_to_lower(str_trim(as.character(artists))),
                           title = str_to_lower(str_trim(title))) |>
                    mutate(artist = word(artists, 1, sep = ",")) |>
                    select(-artists) |>
                    relocate(artist, .after = title)
  

spotify_2025_R

Join Dataset 5 to Each Country's Dataset for 2025 Happiness Analysis

https://dplyr.tidyverse.org/reference/distinct.html

Ireland Dataset

{r}

## Join Ireland dataframe and updated Spotify dataframe
## Left join to keep all the rows of left dataframe
ireland_2025_matched_r <- ireland_2025 |>
                            left_join(spotify_2025_R,
                                      join_by(Artist == artist,
                                              Title == title))
ireland_2025_matched_r

{r}

## Remove duplicate 
## Drop title and artist columns from spotify_2025_py_cleaned
## Drop duplicate rows and songs with no analytic data
ireland_2025_matched_r_cleaned <- ireland_2025_matched_r |>
                                    distinct(Artist, Title, .keep_all = TRUE) |>
                                    drop_na(danceability)

ireland_2025_matched_r_cleaned

New Zealand Dataset

{r}

## Join New Zealand dataframe and updated Spotify dataframe
## Left join to keep all the rows of left dataframe
new_zealand_2025_matched_r <- new_zealand_2025 |>
                                left_join(spotify_2025_R,
                                          join_by(Artist == artist,
                                                  Title == title))
new_zealand_2025_matched_r

{r}

## Remove duplicate 
## Drop title and artist columns from spotify_2025_py_cleaned
## Drop duplicate rows and songs with no analytic data
new_zealand_2025_matched_r_cleaned <- new_zealand_2025_matched_r |>
                                        distinct(Artist, Title, .keep_all = TRUE) |>
                                        drop_na(danceability)

new_zealand_2025_matched_r_cleaned

South Korea Dataset

{r}

## Join South Korea dataframe and updated Spotify dataframe
## Left join to keep all the rows of left dataframe
south_korea_2025_matched_r <- south_korea_2025 |>
                                left_join(spotify_2025_R,
                                          join_by(Artist == artist,
                                                  Title == title))
south_korea_2025_matched_r

{r}

## Remove duplicate 
## Drop title and artist columns from spotify_2025_py_cleaned
## Drop duplicate rows and songs with no analytic data
south_korea_2025_matched_r_cleaned <- south_korea_2025_matched_r |>
                                        distinct(Artist, Title, .keep_all = TRUE) |>
                                        drop_na(danceability)

south_korea_2025_matched_r_cleaned

USA Dataset

{r}

## Join USA dataframe and updated Spotify dataframe
## Left join to keep all the rows of left dataframe
usa_2025_matched_r <- usa_2025 |>
                        left_join(spotify_2025_R,
                                  join_by(Artist == artist,
                                          Title == title))
usa_2025_matched_r

{r}

## Remove duplicate 
## Drop title and artist columns from spotify_2025_py_cleaned
## Drop duplicate rows and songs with no analytic data
usa_2025_matched_r_cleaned <- usa_2025_matched_r |>
                                        distinct(Artist, Title, .keep_all = TRUE) |>
                                        drop_na(danceability)

usa_2025_matched_r_cleaned

SQL

Establish connection with duckdb

{r}

library(DBI)
library(duckdb)
options(duckdb.enable_rstudio_connection_pane=TRUE)

drv <- duckdb()
con <- dbConnect(drv)

Import & Wrangle Dataset 1

Import & Wrangle Dataset 2

Import & Wrangle Dataset 3

{r}

## Import world_data_2023
dbWriteTable(con, "world_data_2023", `world_data_2023`, overwrite = TRUE)

{sql}
#| connection: con      
#| echo: true

-- Select County and Abbreviation columns only

SELECT Country, Abbreviation
FROM world_data_2023

Import & Wrangle Dataset 4

Ireland Dataset

{r}

## Import 10_16_25_ireland
dbWriteTable(con, "ireland_2025_sql", `10_16_25_ireland`, overwrite = TRUE)

{sql}
#| connection: con      
#| echo: true

-- Import weekly chart of Ireland and remove all columns 
-- except for the Artist.and.Title column.
-- Separate artist and song title from the Artist.and.Title column.
SELECT STRING_SPLIT("Artist.and.Title", '-')[1] AS Artist,
       STRING_SPLIT("Artist.and.Title", '-')[2] AS Title
FROM ireland_2025_sql

New Zealand Dataset

{r}

## Import 10_16_25_new_zealand
dbWriteTable(con, "new_zealand_2025_sql", `10_16_25_new_zealand`, overwrite = TRUE)

{sql}
#| connection: con      
#| echo: true

-- Import weekly chart of New Zealand and remove all columns 
-- except for the Artist.and.Title column.
-- Separate artist and song title from the Artist.and.Title column.
SELECT STRING_SPLIT("Artist.and.Title", '-')[1] AS Artist,
       STRING_SPLIT("Artist.and.Title", '-')[2] AS Title
FROM new_zealand_2025_sql

South Korea Dataset

{r}

## Import 10_16_25_korea
dbWriteTable(con, "south_korea_2025_sql", `10_16_25_korea`, overwrite = TRUE)

{sql}
#| connection: con      
#| echo: true

-- Import weekly chart of South Korea and remove all columns 
-- except for the Artist.and.Title column.
-- Separate artist and song title from the Artist.and.Title column.
SELECT STRING_SPLIT("Artist.and.Title", '-')[1] AS Artist,
       STRING_SPLIT("Artist.and.Title", '-')[2] AS Title
FROM south_korea_2025_sql

USA Dataset

{r}

## Import 10_16_25_usa
dbWriteTable(con, "usa_2025_sql", `10_16_25_usa`, overwrite = TRUE)

{sql}
#| connection: con      
#| echo: true

-- Import weekly chart of USA and remove all columns 
-- except for the Artist.and.Title column.
-- Separate artist and song title from the Artist.and.Title column.
SELECT STRING_SPLIT("Artist.and.Title", '-')[1] AS Artist,
       STRING_SPLIT("Artist.and.Title", '-')[2] AS Title
FROM usa_2025_sql

Import & Wrangle Dataset 5 - Universal Top Spotify Songs (Kaggle)

{r}

## Import the Universal Top Spotify Songs dataset
dbWriteTable(con, "spotify_2025_sql", `universal_top_spotify_songs`, overwrite = TRUE)

{sql}
#| connection: con      
#| echo: true

-- Keep following columns only:
-- name, artists, danceability, energy, loudness, liveness, tempo
SELECT name AS title,
       artists,
       danceability,
       energy,
       loudness,
       liveness,
       tempo
FROM spotify_2025_sql

Pandas

Load packages

{r}
library(reticulate)

{python}

import pandas as pd
from io import StringIO
import numpy as np

Import & Wrangle Dataset 1

Import & Wrangle Dataset 2

Import & Wrangle Dataset 3

{python}

world_data_2023_pandas = pd.read_csv('world_data_2023.csv')

world_data_2023_pandas

{python}

## Select only the Country and Abbreviation columns
filtered_world_data_2023_pandas = world_data_2023_pandas.filter(items = ['Country', 'Abbreviation'])

filtered_world_data_2023_pandas

Import & Wrangle Dataset 4

https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.str.split.html

Ireland Dataset

{python}

## Import Ireland's weekly chart for 10-16-2025
ireland_2025_pd = pd.read_csv('10_16_25_ireland.txt')

ireland_2025_pd

{python}

## Extract only the Artist.and.Title column
## Separate artist and song title from the Artist.and.Title column
## Remove any white space before and after string
## Change both columns to all lowercase for easier matching
ireland_filtered_2025_pd = (
  ireland_2025_pd
  .filter(items = ['Artist and Title'])
  
  .assign(Artist = lambda df_: df_['Artist and Title'].astype(str).str.split('-', n = 1).str[0].str.strip().str.lower(),
          Title = lambda df_: df_['Artist and Title'].astype(str).str.split('-',  n = 1).str[1].str.strip().str.lower())
  .drop(columns = ['Artist and Title'])  
  )
  

ireland_filtered_2025_pd

New Zealand Dataset

{python}
medals_df = pd.read_csv(StringIO(medals_csv))


{python}

## Import Ireland's weekly chart for 10-16-2025
new_zealand_2025_pd = pd.read_csv('10_16_25_new_zealand.txt')

new_zealand_2025_pd

{python}

## Extract only the Artist.and.Title column
## Separate artist and song title from the Artist.and.Title column
## Remove any white space before and after string
## Change both columns to all lowercase for easier matching
new_zealand_filtered_2025_pd = (
  new_zealand_2025_pd
  .filter(items = ['Artist and Title'])
  
  .assign(Artist = lambda df_: df_['Artist and Title'].str.split('-',  n = 1).str[0].str.strip().str.lower(),
          Title = lambda df_: df_['Artist and Title'].str.split('-',  n = 1).str[1].str.strip().str.lower())
    
  .drop(columns = ['Artist and Title'])  
  )
  

new_zealand_filtered_2025_pd

South Korea Dataset

{python}

## Import Ireland's weekly chart for 10-16-2025
south_korea_2025_pd = pd.read_csv('10_16_25_korea.txt')

south_korea_2025_pd

{python}

## Extract only the Artist.and.Title column
## Separate artist and song title from the Artist.and.Title column
## Remove any white space before and after string
## Change both columns to all lowercase for easier matching
south_korea_filtered_2025_pd = (
  south_korea_2025_pd
  .filter(items = ['Artist and Title'])
  
  .assign(Artist = lambda df_: df_['Artist and Title'].astype(str).str.split('-',  n = 1).str[0].str.strip().str.lower(),
          Title = lambda df_: df_['Artist and Title'].astype(str).str.split('-',  n = 1).str[1].str.strip().str.lower())
    
  .drop(columns = ['Artist and Title'])  
  )
  

south_korea_filtered_2025_pd

USA Dataset

{python}

## Import Ireland's weekly chart for 10-16-2025
usa_2025_pd = pd.read_csv('10_16_25_usa.txt')

usa_2025_pd

{python}

## Extract only the Artist.and.Title column
## Separate artist and song title from the Artist.and.Title column
## Remove any white space before and after string
## Change both columns to all lowercase for easier matching
usa_filtered_2025_pd = (
  usa_2025_pd
  .filter(items = ['Artist and Title'])
  
  .assign(Artist = lambda df_: df_['Artist and Title'].str.split('-',  n = 1).str[0].str.strip().str.lower(),
          Title = lambda df_: df_['Artist and Title'].str.split('-',  n = 1).str[1].str.strip().str.lower())
    
  .drop(columns = ['Artist and Title'])  
  )
  

usa_filtered_2025_pd

Import & Wrangle Dataset 5 - Universal Top Spotify Songs (Kaggle)

{python}

## Import the Universal Top Spotify Songs dataset
spotify_2025_py = pd.read_csv('universal_top_spotify_songs.csv')

spotify_2025_py.columns

{python}

## Keep following columns only:
## name, artists, danceability, energy, loudness, liveness, tempo
## Remove any white space before and after string
## Change both columns to all lowercase for easier matching
spotify_2025_py_cleaned = (
  
  spotify_2025_py
  .assign(artist = lambda df_: df_['artists'].astype(str).str.split(',').str[0].str.strip().str.lower())
  .assign(title = lambda df_: df_['name'].astype(str).str.strip().str.lower())
  .filter(items = ['title', 'artist', 'danceability', 'energy', 'loudness', 'liveness', 'tempo'])
)

spotify_2025_py_cleaned

Join Dataset 5 to Each Country's Dataset for 2025 Happiness Analysis

Ireland Dataset

{python}

## Join Ireland dataframe and updated Spotify dataframe
ireland_2025_matched = ireland_filtered_2025_pd.merge(
    spotify_2025_py_cleaned,
    left_on = ['Title', 'Artist'],
    right_on = ['title', 'artist'],
    how = 'left'
)


## Clean up the joined dataframe
## Drop title and artist columns from spotify_2025_py_cleaned
## Drop duplicate rows and songs with no analytic data
ireland_2025_matched_cleaned = (
  ireland_2025_matched
    .drop(columns=['title', 'artist'])
    .drop_duplicates(subset=['Title', 'Artist'])
    .dropna(subset=['danceability'])
  )

ireland_2025_matched_cleaned

New Zealand Dataset

{python}

## Join New Zealand dataframe and updated Spotify dataframe
## Left join to keep all the rows of left dataframe
new_zealand_2025_matched = new_zealand_filtered_2025_pd.merge(
    spotify_2025_py_cleaned,
    left_on = ['Title', 'Artist'],
    right_on = ['title', 'artist'],
    how = 'left'
)


## Clean up the joined dataframe
## Drop title and artist columns from spotify_2025_py_cleaned
## Drop duplicate rows and songs with no analytic data
new_zealand_2025_matched_cleaned = (
  new_zealand_2025_matched
    .drop(columns = ['title', 'artist'])
    .drop_duplicates(subset = ['Title', 'Artist'])
    .dropna(subset = ['danceability'])
  )

new_zealand_2025_matched_cleaned

South Korea Dataset

{python}

## Join South Korea dataframe and updated Spotify dataframe
## Left join to keep all the rows of left dataframe
south_korea_2025_matched = south_korea_filtered_2025_pd.merge(
    spotify_2025_py_cleaned,
    left_on = ['Title', 'Artist'],
    right_on = ['title', 'artist'],
    how = 'left'
)


## Clean up the joined dataframe
## Drop title and artist columns from spotify_2025_py_cleaned
## Drop duplicate rows and songs with no analytic data
south_korea_2025_matched_cleaned = (
  south_korea_2025_matched
    .drop(columns = ['title', 'artist'])
    .drop_duplicates(subset = ['Title', 'Artist'])
    .dropna(subset = ['danceability'])
  )

south_korea_2025_matched_cleaned

USA Dataset

{python}

## Join South Korea dataframe and updated Spotify dataframe
## Left join to keep all the rows of left dataframe
usa_2025_matched = usa_filtered_2025_pd.merge(
    spotify_2025_py_cleaned,
    left_on = ['Title', 'Artist'],
    right_on = ['title', 'artist'],
    how = 'left'
)


## Clean up the joined dataframe
## Drop title and artist columns from spotify_2025_py_cleaned
## Drop duplicate rows and songs with no analytic data
usa_2025_matched_cleaned = (
  usa_2025_matched
    .drop(columns = ['title', 'artist'])
    .drop_duplicates(subset = ['Title', 'Artist'])
    .dropna(subset = ['danceability'])
  )

usa_2025_matched_cleaned

Excel Queries

